@*@model IEnumerable<BLL.DTO.SubPageDTO>*@
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@model SimpleVote.UI.Models.ViewModels.MySubPagesListViewModel
    <head>
        <link rel="stylesheet" href="~/css/modalMessage.css"/>
    </head>
@if (Model.forms.Count() != 0)
{
    @foreach (var form in Model.forms)
    {
        bool isBlock = Model.FinishedFormsIDs.Contains(form.Id);

        <div class="subpage-card">
            <div>
                <div class="@(isBlock?"block-area-title":"white-area-title")">
                    <h3 class="text-left arial-bold-text" style="font-family: 'Arial' !important; font-weight: 700 !important; font-size:19px">@form.Header</h3>
                </div>
                <div class="d-flex flex-wrap">
                    <div class="white-area" style="width:30%;">
                        @{
                            BLL.DTO.SubPageStatDTO stat = Model.statService.GetStat(form.Id) == null ? new BLL.DTO.SubPageStatDTO() { Subscriptions = 0, Views = 0} :  Model.statService.GetStat(form.Id);
                        }
                        <div class="text-left arial-bold-text" style="font-family: 'Arial' !important; font-weight: 700 !important; font-size:16px;">@Localizer["Views"]: @stat.Views</div>
                        <div class="text-left arial-bold-text" style="font-family: 'Arial' !important; font-weight: 700 !important; font-size:16px;color:#288A26;">@Localizer["Subscriptions"]: @stat.Subscriptions</div>
                    </div>
                    <div class="white-area" style="width:45%;">
                        <div class="text-left arial-bold-text" style="font-family: 'Arial' !important; font-weight: 700 !important; font-size:16px;">@Localizer["SubscriptionRate"]:
                            @if (@stat.Views != 0)
                            {
                                @if (@Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2) < 10)
                                {
                                    <span style="color: #C96D3A;">@Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2)%</span>
                                }
                                else
                                {
                                    @if (@Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2) < 20)
                                    {
                                        <span style="color: #E3C454;">@Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100),2)%</span>
                                    }
                                    else
                                    {
                                        <span style="color: #288A26;">@Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2)%</span>
                                    }
                                }
                            }
                            else
                            {
                                <span style="color: #C96D3A;">0%</span>
                            }
                        </div>
                        <div class="text-left arial-bold-text" style="font-family: 'Arial' !important; font-weight: 700 !important; font-size:16px;">
                            @Localizer["BounceRate"]:
                            @if (@stat.Views != 0)
                            {
                                @if (((@stat.Subscriptions / @stat.Views) * 100) < 10)
                                {
                                    <span style="color: #C96D3A;">@((100 - @Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2)))%</span>
                                }
                                else
                                {
                                    @if (((@stat.Subscriptions / @stat.Views) * 100) < 20)
                                    {
                                        <span style="color: #E3C454;">@((100 - @Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100),2)))%</span>
                                    }
                                    else
                                    {
                                        <span style="color: #288A26;">@((100 - @Math.Round(((((double)@stat.Subscriptions/(double)@stat.Views))*100), 2)))%</span>
                                    }
                                }
                            }
                            else
                            {
                                <span style="color: #C96D3A;">100%</span>
                            }
                        </div>
                    </div>
                </div>
                <h5 class="mt-4" style="font-family: 'Prompt' !important; font-size:16px; margin-left: 20px;">@Localizer["Created"]: @($"{form?.CreationDate.Day}.{form?.CreationDate.Month}.{form?.CreationDate.Year}")</h5>
            </div>

            <div class="center-btn-crud d-flex flex-wrap">
                <a style="border: none; margin-left: 0px;" class="crud-btn" onclick="window.open('@Url.Action($"FirstPage","SubPage", new {id=form?.Id})')">
                    <img src="~/images/view_subpage.png" width=35 height=35/>

                </a>
                <a style="border: none; margin-left: 0px; margin-top: 10px;" class="crud-btn" href="/SubPages/CreateSubPage?subPageId=@form.Id&userId=@Model.UserId">
                    <img src="~/images/edit_subpage.png" width=35 height=35/>
                </a>
                <button style="border: none; margin-left: -5px;" class="crud-btn" data-bs-toggle="modal" data-bs-target="#@($"modal{form.Id}")">
                    <img src="~/images/remove-img.png" width=35 height=35/>
                </button> 

                <div class="modal fade" id="@($"modal{form.Id}")" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-header">Повідомлення</h5>
                                <button type="button" class="close-btn mb-3" id="close-btn" onclick="closeModalWindow(this)" data-bs-dismiss="modal">X</button>
                            </div>
                            <div class="modal-body">
                                    <p class="ms-3 mb-5">Ви впевнені?</p>
                                    <form method="post" asp-action="DeleteSubPage" asp-controller="SubPages">
                                        <input value="@form.Id" type="hidden" name="Id">
                                        <input type="submit" value="Так" class="ok-button mx-auto" data-bs-dismiss="modal">
                                    </form>
                                
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    }
}
@*else
{
    <head>
        <link rel="stylesheet" href=~/css/plans.css/>
    </head>

       <div class="container-fluid col-xxl-3">
           <button class="blue-button">Створити</button>
       </div>
       

        
}*@